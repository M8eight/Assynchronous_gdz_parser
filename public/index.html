<!DOCTYPE html>
<html>

<head>
    <title>Гдз</title>
    <meta charset="utf-8" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <style>
        .imgStyle {
            border-style: solid;
        }
    </style>

</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-2"></div>
            <div class="col-8">

                    <h1 class="text-center">Гдз оффлайн</h1>
                <form name="parseBook">
                    <h3 class="text-center">Алгебра: alg9</h3>
                    <h3 class="text-center">Английский: eng9</h3>
                    <input placeholder="Учебник" class="form-control" aria-label="Username"
                        aria-describedby="basic-addon1" type="text" name="book">
                    <input placeholder="Номер" class="form-control" aria-label="Username"
                        aria-describedby="basic-addon1" type="text" name="num" /></br></br>
                    <button class="btn btn-info" type="submit" id="submit">Отправить</button>  
                </form>
                <br>

                <div id="imgContainer"></div>

            </div>
            <div class="col-2"></div>
        </div>
    </div>
    <br>

        <script>
        var imgContainer = document.getElementById('imgContainer');
        document.getElementById("submit").addEventListener("click", function (e) {
            e.preventDefault();
            if (document.getElementsByClassName('imgStyle').length != 0) {
                $('#imgContainer').empty();
            }
            let registerForm = document.forms["parseBook"];
            let book = registerForm.elements["book"].value;
            let number = registerForm.elements["num"].value;
            let user = JSON.stringify({
                book: book,
                number: number
            });
            let request = new XMLHttpRequest();
            request.open("POST", "/post", true);
            request.setRequestHeader("Content-Type", "application/json");

            request.addEventListener("load", function () {
                $('.spin').remove();
                $('#imgContainer').empty();
                let responseJSON = JSON.parse(request.response);
                if (responseJSON == 'error') {
                    textError = document.createElement('div');
                    textError.innerHTML =
                        `<h3>Ошибка, неверно выбранны параметры</h3>`;
                    imgContainer.append(textError);
                } else {
                    for (let i = 0; i < responseJSON.length; i++) {
                        let img = document.createElement('img');
                        img.setAttribute('src', responseJSON[i]);
                        img.setAttribute('class', 'imgStyle');
                        imgContainer.append(img);
                    }
                }
            });

            request.addEventListener("error", function () {
                textAlert = document.createElement('div');
                textAlert.innerHTML =
                    `<h2>Ошибка</h2>`;
                imgContainer.append(textAlert);
                setTimeout(function () {
                    location.reload();
                }, 2000);
            });

            request.addEventListener("progress", function () {
                if (document.getElementsByClassName('imgStyle').length != 0) {
                    $('#imgContainer').empty();
                }
                progressAnim = document.createElement('div');
                progressAnim.innerHTML =
                    `<div class="spinner-border spin" role="status"><span class="visually-hidden">Loading...</span></div>`;
                imgContainer.append(progressAnim);
            });

            request.send(user);
        });
    </script>
</body>
<html>